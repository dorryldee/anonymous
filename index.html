<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anonymous Rotation Draw</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: #f4f4f4;
            padding: 40px;
        }
        #container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            max-width: 400px;
            margin: auto;
        }
        button {
            background: #007bff;
            color: white;
            padding: 12px 20px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        button:disabled {
            background: gray;
            cursor: not-allowed;
        }
        h2 {
            color: #333;
        }
        #result {
            font-size: 22px;
            margin-top: 20px;
            font-weight: bold;
        }
        #time {
            color: gray;
            font-size: 14px;
            margin-top: 5px;
        }
    </style>
</head>
<body>

<div id="container">
    <h2>Anonymous Rotation Draw</h2>
    <button id="drawBtn">Draw</button>
    <p id="result"></p>
    <p id="time"></p>
</div>

<!-- Firebase SDK -->
<script type="module">
    // Import Firebase functions
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } 
        from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

    // Your Firebase config
    const firebaseConfig = {
        apiKey: "AIzaSyDbXn-rN-xnjMYuRMlcMt9sVCEhMsFE2eg",
        authDomain: "anonymous-rotation-draw-eb9f1.firebaseapp.com",
        projectId: "anonymous-rotation-draw-eb9f1",
        storageBucket: "anonymous-rotation-draw-eb9f1.firebasestorage.app",
        messagingSenderId: "458050330906",
        appId: "1:458050330906:web:037a194835d337acdc8ca3"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Members list
    const members = ["Member 1", "Member 2", "Member 3", "Member 4", "Member 5", "Member 6", "Member 7"];

    // Check if user already drew
    if (localStorage.getItem("hasDrawn") === "true") {
        document.getElementById("drawBtn").disabled = true;
        document.getElementById("result").innerText = "You already drew.";
    }

    document.getElementById("drawBtn").addEventListener("click", async () => {
        const randomMember = members[Math.floor(Math.random() * members.length)];

        // Save to Firestore with timestamp
        await addDoc(collection(db, "draws"), {
            member: randomMember,
            timestamp: serverTimestamp()
        });

        // Show result & time
        const now = new Date();
        document.getElementById("result").innerText = `You got: ${randomMember}`;
        document.getElementById("time").innerText = `Drawn at: ${now.toLocaleString()}`;

        // Block further draws
        localStorage.setItem("hasDrawn", "true");
        document.getElementById("drawBtn").disabled = true;
    });
</script>

</body>
</html>
